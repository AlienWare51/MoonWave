<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EaselJS Interactive Animation</title>
    <script src="https://code.createjs.com/1.0.0/easeljs.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #gameCanvas {
            touch-action: none;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        // Initialize the stage
        const stage = new createjs.Stage("gameCanvas");
        createjs.Touch.enable(stage);
        createjs.Ticker.framerate = 60;
        createjs.Ticker.addEventListener("tick", stage);

        // Call the function to create the interactive image at position (188, 445)
        createInteractiveImage(stage, 188, 445);

        // Encapsulated function
        function createInteractiveImage(stage, posX, posY) {
            // Variables scoped within the function
            let stewieImg = new Image();
            let putinImg = new Image();
            let currentBitmap;
            let isStewie = true;
            let hue = 0;

            // Set crossOrigin to handle cross-origin images
            stewieImg.crossOrigin = 'Anonymous';
            putinImg.crossOrigin = 'Anonymous';

            // URLs of the images
            stewieImg.src = 'https://www.nicepng.com/png/detail/138-1380123_giant-stewie-stewie-as-an-octopus.png';
            putinImg.src = 'https://upload.wikimedia.org/wikipedia/commons/d/d1/Vladimir_Putin_12020.jpg';

            // Load images
            let imagesLoaded = 0;
            stewieImg.onload = handleImageLoad;
            putinImg.onload = handleImageLoad;

            function handleImageLoad() {
                imagesLoaded++;
                if (imagesLoaded === 2) {
                    init();
                }
            }

            function init() {
                // Create bitmap for Stewie image
                currentBitmap = new createjs.Bitmap(stewieImg);
                scaleAndPositionBitmap(currentBitmap);
                stage.addChild(currentBitmap);

                // Start color-changing animation
                createjs.Ticker.addEventListener("tick", colorChangeTick);

                // Set up interaction event listeners
                stage.on('stagemousedown', handleMouseDown);
                stage.on('stagemouseup', handleMouseUp);
            }

            function scaleAndPositionBitmap(bitmap) {
                const desiredSize = 100;
                const scale = desiredSize / bitmap.image.width;
                bitmap.scaleX = bitmap.scaleY = scale;
                bitmap.x = posX; // Position at the provided x coordinate
                bitmap.y = posY; // Position at the provided y coordinate
            }

            // Color-changing animation
            function colorChangeTick(event) {
                hue = (hue + 1) % 360;
                const colorFilter = new createjs.ColorFilter();
                colorFilter.adjustHue(hue);
                currentBitmap.filters = [colorFilter];
                currentBitmap.cache(0, 0, currentBitmap.image.width, currentBitmap.image.height);
            }

            // Swipe detection variables
            let swipeCount = 0;
            let lastSwipeTime = 0;
            let touchStartY = null;
            let touchStartTime = 0;

            // Touch event handlers
            function handleMouseDown(event) {
                if (isOverBitmap(event.stageX, event.stageY)) {
                    touchStartY = event.stageY;
                    touchStartTime = event.timeStamp;
                }
            }

            function handleMouseUp(event) {
                if (touchStartY === null) return;

                const touchEndY = event.stageY;
                const touchEndTime = event.timeStamp;
                const deltaY = touchStartY - touchEndY;
                const deltaTime = touchEndTime - touchStartTime;

                // Reset touch start
                touchStartY = null;
                touchStartTime = 0;

                // Check for swipe up gesture
                if (deltaY > 50 && deltaTime < 500) {
                    const currentTime = event.timeStamp;
                    if (currentTime - lastSwipeTime < 600) {
                        swipeCount++;
                    } else {
                        swipeCount = 1;
                    }
                    lastSwipeTime = currentTime;

                    if (swipeCount >= 2) {
                        swapImage();
                        swipeCount = 0;
                    }
                }
            }

            function isOverBitmap(x, y) {
                const bounds = currentBitmap.getBounds();
                const localPoint = currentBitmap.globalToLocal(x, y);
                return localPoint.x >= 0 && localPoint.x <= bounds.width && localPoint.y >= 0 && localPoint.y <= bounds.height;
            }

            function swapImage() {
                // Remove current bitmap and clear cache
                stage.removeChild(currentBitmap);
                currentBitmap.uncache();
                createjs.Ticker.removeEventListener("tick", colorChangeTick);

                if (isStewie) {
                    // Switch to Putin image
                    currentBitmap = new createjs.Bitmap(putinImg);
                } else {
                    // Switch back to Stewie image
                    currentBitmap = new createjs.Bitmap(stewieImg);
                    createjs.Ticker.addEventListener("tick", colorChangeTick);
                }

                scaleAndPositionBitmap(currentBitmap);
                stage.addChild(currentBitmap);
                isStewie = !isStewie;
            }
        }
    </script>
</body>
</html>
