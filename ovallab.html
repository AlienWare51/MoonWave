<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SPYGAME</title>
  <script src="https://code.createjs.com/1.0.0/easeljs.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #additionalCanvas {
      position: absolute;
      left: 198px;
      top: 415px;
      width: 100px;
      height: 100px;
    }
    #coords {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: white;
      padding: 5px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="750" height="550"></canvas>
  <div id="coords">Coordinates: (x, y)</div>
  <canvas id="additionalCanvas" width="100" height="100"></canvas>

  <script>
    const stage = new createjs.Stage("gameCanvas");
    const coordsDisplay = document.getElementById("coords");
    const additionalCanvas = document.getElementById("additionalCanvas");
    const ctx = additionalCanvas.getContext("2d");

    const deskPhotoImg = new Image();
    const lizardManImg = new Image();
    const newImage = new Image();
    const imageForCanvas = new Image();
    const newImageForCanvas = new Image();

    deskPhotoImg.src = 'https://www.thoughtco.com/thmb/bhWbOYCyztO_QuIvPai7k7MRUZw=/2299x1541/filters:fill(auto,1)/Kennedy-Resolute-desk-TV-2300-3x2gty-5867f6775f9b586e025d8e82.jpg';
    lizardManImg.src = 'https://thumbs.dreamstime.com/z/lizard-man-government-person-conspiracy-theory-concept-generative-ai-lizard-man-government-person-conspiracy-theory-concept-277117312.jpg';
    newImage.src = 'https://th.bing.com/th/id/OIP.Tl9okheF9keH4XhtqgagDQHaL9?rs=1&pid=ImgDetMain';
    imageForCanvas.src = 'https://i.ytimg.com/vi/Cl1m3lgW18k/hq720_2.jpg?sqp=-oaymwEYCJwEENAFSFryq4qpAwoIARUAAIhC0AEB&rs=AOn4CLBM1jt037xm4YYDIqImMtP0Oq5KgQ';
    newImageForCanvas.src = 'https://th.bing.com/th/id/OIP._DR7Sg5--1q1kKmpta4VqwHaEK?rs=1&pid=ImgDetMain';

    let deskPhotoBitmap, lizardManBitmap, newImageBitmap, pointer;
    let swipeCount = 0, lastSwipeTime = 0, touchStartY = null, touchStartTime = 0;
    let isFirstImage = true;
    let imagesLoaded = 0;

    function checkAllImagesLoaded() {
      imagesLoaded++;
      if (imagesLoaded === 3) renderStage();
    }

    deskPhotoImg.onload = checkAllImagesLoaded;
    lizardManImg.onload = checkAllImagesLoaded;
    newImage.onload = checkAllImagesLoaded;
    imageForCanvas.onload = () => ctx.drawImage(imageForCanvas, 0, 0, 100, 100);

    function renderStage() {
      deskPhotoBitmap = new createjs.Bitmap(deskPhotoImg);
      deskPhotoBitmap.scaleX = stage.canvas.width / deskPhotoImg.width;
      deskPhotoBitmap.scaleY = stage.canvas.height / deskPhotoImg.height;

      lizardManBitmap = new createjs.Bitmap(lizardManImg);
      lizardManBitmap.scaleX = 100 / lizardManImg.width;
      lizardManBitmap.scaleY = 120 / lizardManImg.height;
      lizardManBitmap.x = 108;
      lizardManBitmap.y = 28;

      newImageBitmap = new createjs.Bitmap(newImage);
      newImageBitmap.scaleX = lizardManBitmap.scaleX;
      newImageBitmap.scaleY = lizardManBitmap.scaleY;
      newImageBitmap.x = 332;
      newImageBitmap.y = 223;

      createjs.Tween.get(newImageBitmap, { loop: true })
        .to({ x: 280, y: 312 }, 1500, createjs.Ease.getPowInOut(2))
        .to({ x: 722, y: 466 }, 1500, createjs.Ease.getPowInOut(2))
        .to({ x: 428, y: 163 }, 1500, createjs.Ease.getPowInOut(2));

      stage.addChild(deskPhotoBitmap, lizardManBitmap, newImageBitmap);

      pointer = new createjs.Shape();
      pointer.graphics.beginFill("rgba(255,0,0,0.5)").drawCircle(0, 0, 5);
      pointer.shadow = new createjs.Shadow("#0ff", 0, 0, 10);
      stage.addChild(pointer);

      stage.on("stagemousemove", (event) => {
        pointer.x = event.stageX;
        pointer.y = event.stageY;
        coordsDisplay.innerHTML = `Coordinates: (${event.stageX}, ${event.stageY})`;
        stage.update();
      });

      createjs.Ticker.framerate = 60;
      createjs.Ticker.addEventListener("tick", stage);
    }

    function swapCanvasImage() {
      ctx.clearRect(0, 0, 100, 100);
    if (isFirstImage) {
      ctx.drawImage(newImageForCanvas, 0, 0, 100, 100);
      window.location.href = "https://en.wikipedia.org/wiki/Special:Random";
    } else {
      ctx.drawImage(imageForCanvas, 0, 0, 100, 100);
      }
      isFirstImage = !isFirstImage;
    }

    additionalCanvas.addEventListener("touchstart", (e) => {
      touchStartY = e.touches[0].clientY;
      touchStartTime = e.timeStamp;
    }, false);

    additionalCanvas.addEventListener("touchend", (e) => {
      const deltaY = touchStartY - e.changedTouches[0].clientY;
      const deltaTime = e.timeStamp - touchStartTime;
      touchStartY = null;
      touchStartTime = 0;

      if (deltaY > 50 && deltaTime < 500) {
        const currentTime = e.timeStamp;
        swipeCount = (currentTime - lastSwipeTime < 600) ? swipeCount + 1 : 1;
        lastSwipeTime = currentTime;
        if (swipeCount >= 2) {
          swapCanvasImage();
          swipeCount = 0;
        }
      }
    }, false);

    // Desktop fallback: double-click to swap
    additionalCanvas.addEventListener("dblclick", swapCanvasImage);

    function createCloud() {
      const cloud = new createjs.Shape();
      cloud.graphics.beginFill("white").drawEllipse(0, 0, 80, 40);
      cloud.x = 250 + Math.random() * 100;
      cloud.y = 100 + Math.random() * 50;
      stage.addChild(cloud);

      const emoji = new createjs.Text("ðŸ‘€", "16px Arial", "#000");
      emoji.x = cloud.x + 25;
      emoji.y = cloud.y + 10;
      stage.addChild(emoji);

      createjs.Tween.get(cloud)
        .to({ y: cloud.y - 100, alpha: 0 }, 2000, createjs.Ease.getPowOut(2))
        .call(() => stage.removeChild(cloud));

      createjs.Tween.get(emoji)
        .to({ y: emoji.y - 100, alpha: 0 }, 2000, createjs.Ease.getPowOut(2))
        .call(() => stage.removeChild(emoji));

      stage.update();
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter") createCloud();
    });
  </script>
</body>
</html>
